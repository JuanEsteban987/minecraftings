<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Minecraft RPG P2P</title>
<style>
body{margin:0;background:#1b1b1b;color:white;font-family:sans-serif;text-align:center}
canvas{background:#6ec6ff;display:block;margin:auto}
#menu{padding:20px}
</style>
</head>
<body>

<div id="menu">
<h2>Minecraft RPG P2P</h2>
<button onclick="host()">HOST</button>
<button onclick="join()">JOIN</button>
<br><br>
<input id="code" placeholder="codigo">
<p id="info"></p>
</div>

<canvas id="game" width="800" height="500" style="display:none"></canvas>

<script>
let pc, channel;
let isHost=false;
let peers={};

function host(){
isHost=true;
startRTC();
}

function join(){
startRTC();
}

function startRTC(){

pc = new RTCPeerConnection({
iceServers:[{urls:"stun:stun.l.google.com:19302"}]
});

channel = pc.createDataChannel("game");

channel.onmessage=e=>{
peers=JSON.parse(e.data);
};

pc.ondatachannel=e=>{
channel=e.channel;
channel.onmessage=ev=>{
peers=JSON.parse(ev.data);
};
};

pc.onicecandidate=e=>{
if(!e.candidate){
let code=btoa(JSON.stringify(pc.localDescription));
document.getElementById("code").value=code;
document.getElementById("info").textContent="Comparte este cÃ³digo";
}
};

if(isHost){
pc.createOffer().then(o=>pc.setLocalDescription(o));
}else{
let code=prompt("Pega el cÃ³digo del host");
let desc=new RTCSessionDescription(JSON.parse(atob(code)));
pc.setRemoteDescription(desc)
.then(()=>pc.createAnswer())
.then(a=>pc.setLocalDescription(a));
}

startGame();
}

// ðŸŽ® juego RPG simple
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
let keys={};
let me={x:200,y:200};
let players={};

onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;

function startGame(){
document.getElementById("menu").style.display="none";
canvas.style.display="block";
loop();
}

function update(){
let sp=2;
if(keys["w"]) me.y-=sp;
if(keys["s"]) me.y+=sp;
if(keys["a"]) me.x-=sp;
if(keys["d"]) me.x+=sp;

players.me=me;

if(channel && channel.readyState==="open"){
channel.send(JSON.stringify(players));
}
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

for(let id in peers){
let p=peers[id];
ctx.fillStyle="cyan";
ctx.fillRect(p.x,p.y,20,20);
}

ctx.fillStyle="yellow";
ctx.fillRect(me.x,me.y,20,20);
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
</script>
</body>
</html>
