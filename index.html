<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>RPG 2D - Versión Final</title>
    <style>
        body { margin: 0; background: #4a7023; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; image-rendering: pixelated; }
        #gui {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.7); color: white;
            padding: 15px; border-radius: 8px; pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="gui">
        <strong>CONTROLES:</strong><br>
        Moverse: <b style="color: #ffeb3b;">WASD</b> (Bloque a bloque)<br>
        Acción: <b style="color: #ffeb3b;">CLICK</b> (Ataca y pone bloque)
    </div>
    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const TILE = 40; // Tamaño del bloque
        const world = {}; // Almacena los bloques
        
        const player = {
            x: TILE * 2,
            y: TILE * 2,
            color: "#3498db",
            name: "JUGADOR 1",
            isAttacking: false
        };

        // Movimiento por rejilla (Grid-based)
        window.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (key === 'w') player.y -= TILE;
            if (key === 's') player.y += TILE;
            if (key === 'a') player.x -= TILE;
            if (key === 'd') player.x += TILE;
            
            // Límites de pantalla
            player.x = Math.max(0, Math.min(player.x, canvas.width - TILE));
            player.y = Math.max(0, Math.min(player.y, canvas.height - TILE));
        });

        // Ataque y Construcción
        window.addEventListener('mousedown', (e) => {
            // Activar arma
            player.isAttacking = true;
            setTimeout(() => player.isAttacking = false, 150);

            // Coordenadas de la rejilla
            const gx = Math.floor(e.clientX / TILE);
            const gy = Math.floor(e.clientY / TILE);
            const key = `${gx},${gy}`;

            // Si hay bloque lo quita, si no, pone uno
            if (world[key]) {
                delete world[key];
            } else {
                world[key] = "#5d4037"; // Color tierra
            }
        });

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. Dibujar el mundo (bloques)
            for (let key in world) {
                const [x, y] = key.split(',').map(Number);
                ctx.fillStyle = world[key];
                ctx.fillRect(x * TILE, y * TILE, TILE, TILE);
                ctx.strokeStyle = "rgba(0,0,0,0.2)";
                ctx.strokeRect(x * TILE, y * TILE, TILE, TILE);
            }

            // 2. Dibujar Nametag
            ctx.fillStyle = "white";
            ctx.font = "bold 14px Arial";
            ctx.textAlign = "center";
            ctx.fillText(player.name, player.x + TILE/2, player.y - 12);

            // 3. Dibujar Jugador
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, TILE, TILE);
            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;
            ctx.strokeRect(player.x, player.y, TILE, TILE);

            // 4. Dibujar Arma (Solo si está atacando)
            if (player.isAttacking) {
                ctx.fillStyle = "#dfe6e9"; // Hoja de la espada
                ctx.fillRect(player.x + TILE - 5, player.y + 15, 25, 8);
                ctx.fillStyle = "#2d3436"; // Mango
                ctx.fillRect(player.x + TILE - 5, player.y + 12, 5, 14);
            }

            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
